<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro Sanitario Larrabide - Display TV</title>
    <!-- Mantiene las mismas dependencias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tus estilos originales permanecen */
        body {
            font-family: 'Arial', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const DisplayTV = () => {
            const GOOGLE_SHEETS_URLS = {
                0: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=171121620&single=true&output=csv',
                1: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=0&single=true&output=csv',
                2: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=1617258781&single=true&output=csv',
                3: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=81958565&single=true&output=csv',
                4: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=1770303449&single=true&output=csv',
                5: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=953156936&single=true&output=csv',
                6: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQzlS8zkchIdkBhNbEU5TUk3KS3UVeX5K4yUza_BCQeMmFqraBRovGVEyfUZX59A9stCotFo-LhvO/pub?gid=1052447720&single=true&output=csv',
            };

            const PROXY_URL = 'https://corsproxy.io/?';
            const getDayOfWeek = () => new Date().getDay();

            const [profesionales, setProfesionales] = useState([]);
            const [error, setError] = useState("");

            const getCurrentDayURL = () => {
                const day = getDayOfWeek();
                const sheetURL = GOOGLE_SHEETS_URLS[day];
                return PROXY_URL + encodeURIComponent(sheetURL);
            };

            const parseCSV = (csv) => {
                const lines = csv.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                return lines.slice(1).map(line => {
                    const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                    return headers.reduce((obj, header, index) => {
                        obj[header] = values[index] || "";
                        return obj;
                    }, {});
                });
            };

            const loadProfesionales = async () => {
                const currentURL = getCurrentDayURL();
                console.log("Cargando URL:", currentURL);
                try {
                    const response = await fetch(currentURL);
                    if (!response.ok) {
                        throw new Error(`Error ${response.status} - ${response.statusText}`);
                    }
                    const csvText = await response.text();
                    const parsedData = parseCSV(csvText);
                    setProfesionales(parsedData);
                    setError(""); // Limpia error si tiene éxito
                } catch (e) {
                    console.error("Error cargando datos:", e);
                    setError("No se pudieron cargar los datos de la hoja de cálculo.");
                }
            };

            useEffect(() => {
                loadProfesionales();
                const interval = setInterval(loadProfesionales, 5 * 60 * 1000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div>
                    {error && <p style={{ color: "red" }}>{error}</p>}
                    {profesionales.length === 0 && !error ? (
                        <p>Cargando datos...</p>
                    ) : (
                        profesionales.map((prof, index) => (
                            <div key={index} style={{ margin: "10px 0" }}>
                                <p>
                                    <strong>Despacho:</strong> {prof.numeroDespacho || "N/A"}
                                </p>
                                <p>
                                    <strong>Nombre:</strong> {prof.nombre || "N/A"}
                                </p>
                                <p>
                                    <strong>Especialidad:</strong> {prof.especialidad || "N/A"}
                                </p>
                            </div>
                        ))
                    )}
                </div>
            );
        };

        ReactDOM.render(<DisplayTV />, document.getElementById('root'));
    </script>
</body>
</html>
